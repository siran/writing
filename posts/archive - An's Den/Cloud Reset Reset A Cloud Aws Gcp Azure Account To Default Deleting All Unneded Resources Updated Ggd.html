<meta charset="utf-8">
<p>Ever wanted to reset (delete all the resources) from a cloud account (AWS/GCP/…)? Now you can, and its really easy.</p><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/$s_!2Zqj!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!2Zqj!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png 424w, https://substackcdn.com/image/fetch/$s_!2Zqj!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png 848w, https://substackcdn.com/image/fetch/$s_!2Zqj!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png 1272w, https://substackcdn.com/image/fetch/$s_!2Zqj!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png 1456w" sizes="100vw"><img src="https://substack-post-media.s3.amazonaws.com/public/images/ced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/ced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:null,&quot;width&quot;:null,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;Easily throw away (DELETE) unneeded resources.&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:false,&quot;topImage&quot;:true,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" class="sizing-normal" alt="Easily throw away (DELETE) unneeded resources." title="Easily throw away (DELETE) unneeded resources." srcset="https://substackcdn.com/image/fetch/$s_!2Zqj!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png 424w, https://substackcdn.com/image/fetch/$s_!2Zqj!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png 848w, https://substackcdn.com/image/fetch/$s_!2Zqj!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png 1272w, https://substackcdn.com/image/fetch/$s_!2Zqj!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fced9a985-f0f4-4ffe-b242-009512beb4cc_665x600.png 1456w" sizes="100vw" fetchpriority="high"></picture><div></div></div></a><figcaption class="image-caption">Easily throw away (DELETE) unneeded resources.</figcaption><h2>Freedom</h2><p>We want to give everyone the freedom to explore all what AWS has to offer. So we decided to create a ‘sandbox’ account where everybody could create any resource they want.</p><h2>Freedom has its&nbsp;cost</h2><p>Of course, resources cost money. And as good as we are in giving everyone the freedom to explore, we didn’t want to spend more money than necessary by having lingering zombie resources that nobody knew even existed.</p><p>So, we also wanted to delete all resources periodically.</p><p>This was more easily said than done.</p><h2>Solution</h2><p>I tried finding some GitHub project that already did this, or at least that we could collaborate.</p><p>Although we found a couple (listed below in case you are interested), these we’re writting in Go and we’re too complicated to my test.</p><h2>The project</h2><p>So I literally this afternoon started a GitHub open-source project to achieve this.</p><p>All types of resources are handled by its own class, so its easy to extend.</p><p>The filename where the class is names after the Boto3 resource name (ec2, ec2, ses, s3, etc…).</p><p>If you’re interested in this project, I’d love to see your collaborations. We can keep adding resources.</p><p>The first couple commits are a little messy, just because it’s the start of the project and it get hectic. But the idea is to keep it clean and tidy, tested and following best practices.</p><p>Here’s the <a href="https://github.com/siran/cloud-reset">cloud-reset repo</a>:</p><h2>Let’s disect a bit</h2><p>There is a main script delete_resoures.py that instantiates class called CloudReset.</p><p>When instantiating the class, you have to pass the name of a YAML configuration file. For example, a file named resources_to_delete.yml can have the following contents. This is valid YAML and its specified to delete resources of type ec2 and s3:</p><pre><code>- aws_ec2:
- aws_s3:
    exclude:
        - Name: /-terraform-/ # regular expression
        - Name: /-xxx-/
    options:
        force: true           # deletes bucket contents
- aws_kms:
</code></pre><p>Down the river, this instantiates the class in the file <code>lib/modules/ec2.py</code> which takes care of finding the ids of all the ec2s and deleting them.</p><p>Notice that for resource <code>s3</code> it’s possible to filter the resources to be deleted. We can <code>exclude</code> resources with <code>Name</code> matching a regular expression.</p><p>The <code>ec2.py</code> file (or any other resource file) is quite simple. It inherits from the <code>BaseResource</code> class, which enforces to have at least 3 methods:</p><ul><li><p>get_resources()</p></li><li><p>list_resources()</p></li><li><p>delete_resources()</p></li></ul><h2>How to run</h2><p>Before calling the script, be sure to install the requirements:</p><pre><code>pip3 install -r requirements.txt
</code></pre><p>The script can be called as:</p><pre><code>python delete_resources.py -f resources_to_delete.yml
</code></pre><p>The script is configured with a <code>dry_run</code> flag set initially to <code>True</code> , so it should not delete anything by default. But be careful anyways.</p><h2>Future plans</h2><p>In the future, we’re planning to specify in the YAML configuration file options to filter by tags, creation date and more. Also we’d like to add other cloud providers as GCP or Azure.</p><p>If you like the idea, clone the repo and show what you’ve got. There are many things we can do.</p><p>That’s it for now, but I hope to know more about you!</p><p><a href="https://medium.com/@mrodz/reset-an-aws-account-to-default-889c0a0680f6">Full article here</a></p><p><em><a href="https://dev.to/michrodz/cloud-reset-reset-a-cloud-aws-gcp-azure-account-to-default-deleting-all-unneded-resources-updated-ggd">This post is also available on DEV.</a></em></p>